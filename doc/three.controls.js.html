<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: three.controls.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: three.controls.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Based on PointerLockControls.js. Requires THREE.unitVectors, as defined in
 *   three.extensions.js.
 * @author      mrdoob / http://mrdoob.com/ Edited by Chris.
 * @constructor THREE.Controls
 * @memberOf    THREE
 */
(function (_, THREE) {
  'use strict';

  THREE.Controls = function (camera, options) {
    var self = this;

    this.camera = camera;
    this.options = _.assign({
      'lookSpeed': 0.00025,
      'zSpeed': 500,
      'strafeSpeed': 500,
      'rollSpeed': 2
    }, options);

    this.resetStates();

    // event handlers
    // not in the propotype because they need to reference self
    this.events = {
      'mousemove': function (event) {
        var movementX, movementY;

        // extra check that we are allowed to move
/*        if (!self.enabled) {
          return;
        }
*/
        movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
        movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

        // TODO perform the rotation in update() instead of here -Chris
        self.camera.rotateOnAxis(THREE.unitVectors.x, -movementY * self.options.lookSpeed);
        self.camera.rotateOnAxis(THREE.unitVectors.y, -movementX * self.options.lookSpeed);
      },
      'keydown': function (event) {
        switch (event.which) {
          case 38: case 87: self.states.moveForward = true; break; // up, W
          case 40: case 83: self.states.moveBackward = true; break; // down, S
          case 37: case 65: self.states.moveLeft = true; break; // left, A
          case 39: case 68: self.states.moveRight = true; break; // right, D
          case 82: self.states.moveUp = true; break; // R
          case 70: self.states.moveDown = true; break; // F
          case 81: self.states.rollLeft = true; break; // Q
          case 69: self.states.rollRight = true; break; // E
        }
      },
      'keyup': function (event) {
        switch (event.which) {
          case 38: case 87: self.states.moveForward = false; break; // up, W
          case 40: case 83: self.states.moveBackward = false; break; // down, S
          case 37: case 65: self.states.moveLeft = false; break; // left, A
          case 39: case 68: self.states.moveRight = false; break; // right, D
          case 82: self.states.moveUp = false; break; // R
          case 70: self.states.moveDown = false; break; // F
          case 81: self.states.rollLeft = false; break; // Q
          case 69: self.states.rollRight = false; break; // E
        }
      }
    };
  };



  /**
   * Reset all movement states to false.
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.resetStates = function () {
    this.states = {
      'moveForward': false,
      'moveBackward': false,
      'moveLeft': false,
      'moveRight': false,
      'moveUp': false,
      'moveDown': false,
      'rollLeft': false,
      'rollRight': false
    };
  };



  /**
   * Whether the controls are currently enabled.
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.enabled = false;

  /**
   * Enable the controls.
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.enable = function () {
    // can't use jQuery for this.events.mousemove, because we need the
    // properties event.movementX and event.movementY
    document.addEventListener('mousemove', this.events.mousemove, false);
    document.addEventListener('keydown', this.events.keydown, false);
    document.addEventListener('keyup', this.events.keyup, false);

    this.enabled = true;
  };

  /**
   * Disable the controls.
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.disable = function () {
    this.resetStates();

    document.removeEventListener('mousemove', this.events.mousemove, false);
    document.removeEventListener('keydown', this.events.keydown, false);
    document.removeEventListener('keyup', this.events.keyup, false);

    this.enabled = false;
  };



  /**
   * Move the camera based on the current states.
   * @param    {Number} speedMultiplier            Delta which applies to all
   *   movements (both translations and rotations).
   * @param    {Number} translationSpeedMultiplier Additional multiplier which
   *   applies only to translations.
   * @function
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.moveCamera = (function () {
    var translationVector = new THREE.Vector3(), angle, camera, options;

    return function (speedMultiplier, translationSpeedMultiplier) {
      translationVector.set(0, 0, 0);
      angle = 0;
      camera = this.camera;
      options = this.options;

      if (!this.enabled) {
        return;
      }

      // translate
      translationVector = this.getLocalTranslationVector();
      camera.translateX(translationVector.x * options.strafeSpeed *
        speedMultiplier * translationSpeedMultiplier);
      camera.translateY(translationVector.y * options.strafeSpeed *
        speedMultiplier * translationSpeedMultiplier);
      camera.translateZ(translationVector.z * options.zSpeed *
        speedMultiplier * translationSpeedMultiplier);

      // rotate
      if (this.states.rollLeft) {
        angle -= options.rollSpeed * speedMultiplier;
      }
      if (this.states.rollRight) {
        angle += options.rollSpeed * speedMultiplier;
      }
      camera.rotateOnAxis(THREE.unitVectors.z, angle);
    };
  }());



  /**
   * To check whether the camera is currently moving, check
   *   .getTranslationVector().length() > 0.
   * @returns  {THREE.Vector3} A vector corresponding to the current local
   *                           movement direction(s).
   * @function
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.getLocalTranslationVector = (function () {
    var vector = new THREE.Vector3();

    return function () {
      vector.set(0, 0, 0);

      if (!this.enabled) {
        return vector;
      }

      if (this.states.moveForward) {
        vector.add(THREE.unitVectors.negZ);
      }
      if (this.states.moveBackward) {
        vector.add(THREE.unitVectors.z);
      }
      if (this.states.moveLeft) {
        vector.add(THREE.unitVectors.negX);
      }
      if (this.states.moveRight) {
        vector.add(THREE.unitVectors.x);
      }
      if (this.states.moveUp) {
        vector.add(THREE.unitVectors.y);
      }
      if (this.states.moveDown) {
        vector.add(THREE.unitVectors.negY);
      }

      return vector;
    };
  }());

  /**
   * Not used; can delete.
   * @returns  {THREE.Vector3}
   * @memberOf THREE.Controls
   */
  THREE.Controls.prototype.getWorldTranslationVector = function () {
    return this.camera.localToWorld(this.getLocalTranslationVector());
  };
}(_, THREE));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-KIMCHI.html">KIMCHI</a></li></ul><h3>Externals</h3><ul><li><a href="external-THREE.html">THREE</a></li></ul><h3>Classes</h3><ul><li><a href="Body.html">Body</a></li><li><a href="external-THREE.Curve.html">Curve</a></li><li><a href="external-THREE.Matrix3.html">Matrix3</a></li><li><a href="external-THREE.Object3D.html">Object3D</a></li><li><a href="external-THREE.PerspectiveCamera.html">PerspectiveCamera</a></li><li><a href="Mode.html">Mode</a></li><li><a href="THREE.Controls.html">Controls</a></li><li><a href="THREE.Stars.html">Stars</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-KIMCHI.config.html">config</a></li><li><a href="module-KIMCHI.flight.html">flight</a></li><li><a href="module-KIMCHI.flight.modes.html">modes</a></li><li><a href="module-KIMCHI.flight.modes.auto.html">auto</a></li><li><a href="module-KIMCHI.flight.modes.free.html">free</a></li><li><a href="module-KIMCHI.flight.modes.menu.html">menu</a></li><li><a href="module-KIMCHI.format.html">format</a></li><li><a href="module-KIMCHI.pointerLock.html">pointerLock</a></li><li><a href="module-KIMCHI.space.html">space</a></li><li><a href="module-KIMCHI.ui.html">ui</a></li><li><a href="module-KIMCHI.ui.hud.html">hud</a></li><li><a href="module-KIMCHI.ui.notice.html">notice</a></li><li><a href="module-KIMCHI.ui.panel.html">panel</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Mon Sep 02 2013 14:38:07 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
