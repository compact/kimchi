<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: kimchi.pointerlock.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: kimchi.pointerlock.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Pointer lock state (not controls, which are handled by three.controls.js).
 * @namespace pointerLock
 * @memberOf  module:KIMCHI
 */
var KIMCHI = (function (KIMCHI, $) {
	'use strict';

	var pointerLock = {};
	KIMCHI.pointerLock = pointerLock;



	/**
	 * Request pointer lock from the browser. This is called whenever the user
	 *   enters free flight mode.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.request = function () {
		pointerLock.requestPointerLock.call(document.body);
		console.log((new Date()) + ' pointer lock requested');
		console.log(document.pointerLockElement ||
				document.mozPointerLockElement ||
				document.webkitPointerLockElement);
	};

	/**
	 * Has to be called once, before any pointer lock requests.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.init = function () {
		var havePointerLock, body, change, error;

		havePointerLock = 'pointerLockElement' in document ||
			'mozPointerLockElement' in document ||
			'webkitPointerLockElement' in document;
		if (!havePointerLock) {
			// TODO we can use FirstPersonControls here instead
			KIMCHI.notice.set(KIMCHI.config.notices.pointerLockNotSupported);
			return;
		}

		body = document.body;

		/**
		 * The browser's requestPointerLock function, used in {@link
		 *   module:KIMCHI.pointerLock.request}.
		 * @memberOf module:KIMCHI.pointerLock
		 */
		pointerLock.requestPointerLock = body.requestPointerLock ||
			body.mozRequestPointerLock || body.webkitRequestPointerLock;

		change = function () {
			KIMCHI.flight.free.toggle(document.pointerLockElement === body ||
				document.mozPointerLockElement === body ||
				document.webkitPointerLockElement === body);
		};
		document.addEventListener('pointerlockchange', change, false);
		document.addEventListener('mozpointerlockchange', change, false);
		document.addEventListener('webkitpointerlockchange', change, false);

		error = function (event) {
			console.log('Pointer Lock error:');
			console.log(event);
		};
		document.addEventListener('pointerlockerror', error, false);
		document.addEventListener('mozpointerlockerror', error, false);
		document.addEventListener('webkitpointerlockerror', error, false);

		// the initial flight state is false, so bind the relevant event handlers
		KIMCHI.$overlay.on('click', pointerLock.click);
		pointerLock.bind();
	};



	/**
	 * Bind the event handlers for triggering the request of pointer lock.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.bind = function () {
		KIMCHI.$document.on('keydown', pointerLock.keydown);
	};
	/**
	 * Unbind the event handlers for triggering the request of pointer lock.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.unbind = function () {
		KIMCHI.$document.off('keydown', pointerLock.keydown);
	};
	/**
	 * The event handler for pressing Escape to request pointer lock. We request
	 *   pointer lock only on keyup; otherwise, the continued Escape keydown
	 *   event causes the pointer lock to disable immediately, even if one lets
	 *   go of the Escape key asap. Also, the flag pointerLock.keydownInProgress
	 *   prevents multiple handlers of .one('keyup') from being binded.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.keydown = function (event) {
		if (event.which === 27) { // Esc
			pointerLock.keydownInProgress = true;
			$(this).one('keyup', function (event) {
				if (event.which === 27 && pointerLock.keydownInProgress) {
					pointerLock.request();
					pointerLock.keydownInProgress = false;
				}
			});
		}
	};
	/**
	 * Whether the keydown key (Escape, in our case) is currently being pressed.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.keydownInProgress = false;
	/**
	 * The event handler for clicking to request pointer lock.
	 * @memberOf module:KIMCHI.pointerLock
	 */
	pointerLock.click = function () {
		pointerLock.request();
	};



	return KIMCHI;
}(KIMCHI || {}, jQuery));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-KIMCHI.html">KIMCHI</a></li></ul><h3>Classes</h3><ul><li><a href="module-KIMCHI.flight.Mode.html">Mode</a></li><li><a href="module-KIMCHI.space.Body.html">Body</a></li><li><a href="THREE.Controls.html">Controls</a></li><li><a href="THREE.Curve.html">Curve</a></li><li><a href="THREE.Matrix3.html">Matrix3</a></li><li><a href="THREE.Object3D.html">Object3D</a></li><li><a href="THREE.PerspectiveCamera.html">PerspectiveCamera</a></li><li><a href="THREE.Stars.html">Stars</a></li></ul><h3>Namespaces</h3><ul><li><a href="Date.html">Date</a></li><li><a href="Math.html">Math</a></li><li><a href="module-KIMCHI.config.html">config</a></li><li><a href="module-KIMCHI.flight.html">flight</a></li><li><a href="module-KIMCHI.pointerLock.html">pointerLock</a></li><li><a href="module-KIMCHI.space.html">space</a></li><li><a href="THREE.html">THREE</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Fri Aug 30 2013 01:30:49 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
