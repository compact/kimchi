<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: kimchi.time.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: kimchi.time.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * Time controller. When the time is on, the Bodies move; when the time is
 *   off, the Bodies stop moving. We use "on"/"off"/"isOn" rather than
 *   "start"/"stop"/"isEnabled" for a better adjective and to avoid
 *   confusion with THREE.Clock.
 * @namespace time
 * @memberOf  module:KIMCHI
 */
var KIMCHI = (function (KIMCHI, $) {
  'use strict';

  var time, julian, on, julianToGregorian, gregorianToJulian;

  time = {};
  KIMCHI.time = time;

  /**
   * The Julian Date which will determine the current positions of Bodies.
   *   We use the original convention where .0 is noon. The ephemeris data
   *   is given with Julian Dates ending in .0.
   * @private
   * @memberOf module:KIMCHI.time
   */
  julian = 2451544;

  /**
   * The current state of time, whether it is currently on.
   * @private
   * @memberOf module:KIMCHI.time
   */
  on = true;

  /**
   * Based on EGR, Algorithm F ("Optimising") taken from {@link
   *   http://www.merlyn.demon.co.uk/daycount.htm#E2}. Slower than
   *   julianToGregorian().
   * @returns {Array}
   * @private
   * @memberOf module:KIMCHI.time
   */
  julianToGregorian = function (julian) {
    var g = 0, J, t, D, M, Y;

    // offset by (+ 2400001 - 2400000.5) since the param was originally CMJD
    J = julian + 0.5;

    // Alg F : To convert a Julian day number, J, to a date D/M/Y
    g = ((3 * (((4 * J + 274277) / 146097 | 0)) / 4) | 0) - 38; // not Julian
    J += 1401 + g;
    t = 4 * J + 3;
    Y = (t / 1461) | 0;
    t = (t % 1461) >> 2;
    M = ((t * 5 + 461) / 153) | 0;
    D = (((t * 5 + 2) % 153) / 5) | 0;
    if (M > 12) {
      Y++;
      M -= 12;
    }
    return [Y - 4716, M, D + 1];
  };

  /**
   * Based on EGR, Algorithm E ("Optimising") taken from {@link
   *   http://www.merlyn.demon.co.uk/daycount.htm#E1}.
   * @returns {Number} Julian Day Number.
   * @private
   * @memberOf module:KIMCHI.time
   */
  gregorianToJulian = function (Y, M, D) {
    var c, d, g = 0;

    // Alg E : To convert a date D/M/Y to a Julian day number, J
    Y += 4716;
    if (M &lt; 3) {
      Y--;
      M += 12;
    }
    c = Y * 1461 >> 2;
    d = ((153 * M - 457) / 5) | 0;
    g = (((3 * (((Y + 184) / 100) | 0)) / 4) | 0) - 38; // omit for Julian

    // offset by - 2401403 + 2400000.5 to return JD rather than CMJD
    return c + d + D - g -1402.5;
  };



  /**
   * @returns  {Date}
   * @memberOf module:KIMCHI.time
   */
  time.getDMY = function () {
    return julianToGregorian(julian);
  };

  /**
   * @returns  {Number}
   * @memberOf module:KIMCHI.time
   */
  time.getJulian = function () {
    return julian;
  };

  /**
   * Increment the current time based on delta. TODO: Not implemented yet.
   * @param    {Number} delta
   * @memberOf module:KIMCHI.time
   */
  time.increment = function () {
    var newJulian, deferred;

    newJulian = julian + 1;

    if (newJulian &lt;= KIMCHI.ephemeris.lastJulianInBatch) {
      // "Empty" promise to match the return type in the case below.
      return $.when(newJulian);
    } else {
      // We are at the last of the current batch, so we have to load the next
      // batch before incrementing the date. The Deferred object is used to
      // return the position after loading the next batch.
      deferred = $.Deferred();

      KIMCHI.ephemeris.loadBatch(julian).done(function (data) {
        deferred.resolve(data);
      });

      return deferred.promise();
    }
  };

  /**
   * Turn time on.
   * @memberOf module:KIMCHI.time
   */
  time.on = function () {
    on = true;
  };

  /**
   * Turn time off.
   * @memberOf module:KIMCHI.time
   */
  time.off = function () {
    on = false;
  };

  /**
   * @returns  {Boolean} Whether time is currently on.
   * @memberOf module:KIMCHI.time
   */
  time.isOn = function () {
    return on;
  };

  return KIMCHI;
}(KIMCHI || {}, jQuery));</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-KIMCHI.html">KIMCHI</a></li></ul><h3>Externals</h3><ul><li><a href="external-THREE.html">THREE</a></li></ul><h3>Classes</h3><ul><li><a href="Body.html">Body</a></li><li><a href="external-THREE.Curve.html">Curve</a></li><li><a href="external-THREE.Matrix3.html">Matrix3</a></li><li><a href="external-THREE.Object3D.html">Object3D</a></li><li><a href="external-THREE.PerspectiveCamera.html">PerspectiveCamera</a></li><li><a href="external-THREE.Vector3.html">Vector3</a></li><li><a href="Mode.html">Mode</a></li><li><a href="THREE.Controls.html">Controls</a></li><li><a href="THREE.Stars.html">Stars</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-KIMCHI.config.html">config</a></li><li><a href="module-KIMCHI.ephemeris.html">ephemeris</a></li><li><a href="module-KIMCHI.flight.html">flight</a></li><li><a href="module-KIMCHI.flight.modes.html">modes</a></li><li><a href="module-KIMCHI.flight.modes.auto.html">auto</a></li><li><a href="module-KIMCHI.flight.modes.free.html">free</a></li><li><a href="module-KIMCHI.flight.modes.menu.html">menu</a></li><li><a href="module-KIMCHI.format.html">format</a></li><li><a href="module-KIMCHI.pointerLock.html">pointerLock</a></li><li><a href="module-KIMCHI.renderer.html">renderer</a></li><li><a href="module-KIMCHI.size.html">size</a></li><li><a href="module-KIMCHI.space.html">space</a></li><li><a href="module-KIMCHI.time.html">time</a></li><li><a href="module-KIMCHI.ui.html">ui</a></li><li><a href="module-KIMCHI.ui.hud.html">hud</a></li><li><a href="module-KIMCHI.ui.notice.html">notice</a></li><li><a href="module-KIMCHI.ui.panel.html">panel</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Thu Oct 03 2013 20:33:23 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
